

<script type="text/javascript">

    RED.nodes.registerType('InputDevice',{
        category: 'config',
        defaults: {
            inputDeviceName: {value:"",required:true},
        },
        label: function() {
            return this.inputDeviceName;
        }
    });
</script>

<script type="text/x-red" data-template-name="InputDevice">
    <div class="form-row">
        <label for="node-config-input-inputDeviceName"><i class="icon-bookmark"></i> Sensor </label>
        <input type="text" id="node-config-input-inputDeviceName" placeholder="z.B. LDR">
    </div>

</script>



<!--
 Sensor: Config 
-->
<script type="text/javascript">
    RED.nodes.registerType('Sensor',{
        category: 'input',
        defaults: {
            name: {type:"InputDevice", required:true},
            count: {value:"", required:true, validate:RED.validators.number()},
            topic: {value:"",validate: RED.validators.regex(/^(#$|(\+|[^+#]*)(\/(\+|[^+#]*))*(\/(\+|#|[^+#]*))?$)/)},
            qos: {value: "1"},
            broker: {type:"mqtt-broker", required:true},
            parseJson: {value:true},
        },
        color:"#3FADB5",
        inputs:0,
        outputs:1,
        icon: "feed.png",
        label: function() {
            //var testu = RED.nodes.getNode(config.name).inputDeviceName;
            return this.topic||"Sensor";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        
        oneditprepare: function() {
            if (this.qos === undefined) {
                $("#node-input-qos").val("1");
            }
        }
    });
</script>


<!--
 Sensor: Darstellung
<input type="text" id="node-input-name" placeholder="z.B. LDR2">
-->
<script type="text/x-red" data-template-name="Sensor">

    <div class="form-row">
    
        <label for="node-input-broker">
            <i class="fa fa-globe"></i> 
            <span data-i18n="mqtt.label.broker"></span>
        </label>
        
        <input type="text" id="node-input-broker">
        
    </div>
    
    <div class="form-row">
    
        <label for="node-input-name">
            <i class="fa fa-thermometer-3"></i>
            Sensor
        </label>
        
        <input type="text" id="node-input-name">
     </div>
     
    <div class="form-row">
        <label for="node-input-count">
            <i class="fa fa-hashtag"></i> 
            Nummer
        </label>
     
        <input type="text" id="node-input-count" placeholder="z.B. 5">
        
    </div>
    
    <div class="form-row">
    
        <label for="node-input-qos">
            <i class="fa fa-empire"></i>
            <span data-i18n="mqtt.label.qos"></span>
        </label>
        <select id="node-input-qos" style="width:125px !important">
            //Anfang
            <option value="0">0</option>
            <option value="1">1</option>
        </select>
        
    </div>
    
    <div class="form-row" id="node-parseJson">
        <label for="node-input-parseJson">
            <i class="fa fa-binoculars" aria-hidden="true"></i> 
            JSON
        </label>

        <input type="checkbox" id="node-input-parseJson" style="display: inline-block; width: auto; vertical-align: top;">

    </div>
    
    <div class="form-row">
    
        <label for="node-input-topic">
            <i class="fa fa-label"></i>
            Name
        </label>
        
        <input type="text" id="node-input-topic" placeholder="z.B. Temperatur Flur oder TMP5">
        
    </div>
    

    
    
</script>

<!--
 Sensor: Hilfe Text
-->
<script type="text/x-red" data-help-name="Sensor">
    <p>Verbindet sich mit dem Broker und empfängt Daten vom Sensor.</p>
    <p>Ausgabe hat die Parameter:</p>
    <ul>
       <li><code>msg.topic</code></li>
       <li><code>msg.payload</code></li>
       <li><code>msg.qos</code></li>
       <li><code>msg.retain</code></li>
    </ul>
    <p><code>msg.payload</code> wird als String ausgegeben, sofern es kein binary Buffer.
    Mittels des JSON-Nodes und <code>msg.payload.PARAM</code> kann der Sensorparameter PARAM ausgelesen werden.</p>
</script>




























<!--
 Aktor: Config
-->
<script type="text/javascript">
    RED.nodes.registerType('Aktor',{
        category: 'output',
        defaults: {
            broker: {type:"mqtt-broker", required:true},
            name: {value:"", required:true},
            topic: {value:""},
            qos: {value:""}
        },
        color:"#3FADB5",
        inputs:1,
        outputs:0,
        icon: "feed.png",
        align: "right",
        label: function() {
            return this.name||this.topic||"AktorName";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });
</script>



<!--
 MQTT Ausgang: Darstellung
-->


<script type="text/x-red" data-template-name="Aktor">

    <div class="form-row">
        <label for="node-input-broker"><i class="fa fa-globe"></i> <span data-i18n="mqtt.label.broker"></span></label>
        <input type="text" id="node-input-broker">
    </div>
    
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" placeholder="z.B. LED4">
    </div>
    
    <div class="form-row">
        <label for="node-input-qos"><i class="fa fa-empire"></i> <span data-i18n="mqtt.label.qos"></span></label>
        <select id="node-input-qos" style="width:125px !important">
            <option value=""></option>
            <option value="0">0</option>
            <option value="1">1</option>
        </select>
    </div>
    
    <div class="form-row">
        <label for="node-input-topic"><i class="fa fa-tasks"></i> <span data-i18n="common.label.topic"></span></label>
        <input type="text" id="node-input-topic" data-i18n="[placeholder]common.label.topic">
    </div>
    

    

    
    <div class="form-tips">HIER KÖNNTE IHR TIPP STEHEN</span></div>
</script>

<!--
 MQTT Ausgang: Hilfe Text
-->

<script type="text/x-red" data-help-name="Aktor">
    <p>Verbindet sich mit dem Broker und sendet den im Eingang definierten Payload an einen Aktor.</p>
    <p><code>msg.payload</code> enthält den Payload der Nachricht.
    Falls dieser nicht leer ist, wird es vor dem versenden zu JSON umgewandelt.
    </p>
    <p> Topic ist optional und wird standardmäßig esp/sensor/NAME gesetzt. Falls das Topic nicht leer gelassen wird, werden über das definierte Topic Nachrichten versendet.</p>
    <p>QoS ist ebenfalls optinal. Falls QoS leer ist, wird die Nachricht mit dem QoS 0 versendet.</p>
</script>

















































<!--
 MQTT Status Config
-->


<script type="text/javascript">
    RED.nodes.registerType('Status',{
        category: 'input',
        defaults: {
            name: {value:"", required:true},
            topic: {value:"",validate: RED.validators.regex(/^(#$|(\+|[^+#]*)(\/(\+|[^+#]*))*(\/(\+|#|[^+#]*))?$)/)},
            qos: {value: "1"},
            broker: {type:"mqtt-broker", required:true}
        },
        color:"#07bcaa",
        inputs:0,
        outputs:1,
        icon: "envelope.png",
        label: function() {
            return this.name||this.topic||"ClientName";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            if (this.qos === undefined) {
                $("#node-input-qos").val("1");
            }
        }
    });
</script>



<!--
 MQTT Status: Darstellung
-->


<script type="text/x-red" data-template-name="Status">
    
    <div class="form-row">
    
        <label for="node-input-broker">
            <i class="fa fa-globe"></i> 
            <span data-i18n="mqtt.label.broker"></span>
        </label>
        
        <input type="text" id="node-input-broker">
        
    </div>
    
    <div class="form-row">
    
        <label for="node-input-name">
            <i class="fa fa-tag"></i> 
            <span data-i18n="common.label.name"></span>
        </label>
        
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
        
    </div>
    
    <div class="form-row">
    
        <label for="node-input-qos">
            <i class="fa fa-empire"></i>
            <span data-i18n="mqtt.label.qos"></span>
        </label>
        <select id="node-input-qos" style="width:125px !important">
            <option value="0">0</option>
            <option value="1">1</option>
        </select>
        
    </div>
    
    <div class="form-row">
    
        <label for="node-input-topic">
            <i class="fa fa-tasks"></i> 
            <span data-i18n="common.label.topic"></span>
        </label>
        
        <input type="text" id="node-input-topic" data-i18n="[placeholder]common.label.topic">
        
    </div>
    

    
    
</script>

<!--
 MQTT Status: Hilfe Text
-->

<script type="text/x-red" data-help-name="Status">
    <p>Verbindet sich mit dem Broker und gibt den Statusbericht eines Sensors oder Aktors aus.</p>
    <p>Ausgabe hat die Parameter:</p>
    <ul>
       <li><code>msg.topic</code></li>
       <li><code>msg.payload</code></li>
       <li><code>msg.qos</code></li>
       <li><code>msg.retain</code></li>
    </ul>
    <code>msg.payload</code> enthält die Informationen über den Status des Clients. Dieser kann
    mittels des JSON Nodes ausgewertet werden. Über <code>msg.payload.PARAM</code> kann der
    Statusparameter PARAM ausgelesen werden. Für nähere Informationen bitte im Handbuch nachschlagen.
</script>


















































<!--
    MQTT Broker: Config
-->
<script type="text/javascript">
    RED.nodes.registerType('test-mqtt-broker',{
        category: 'config',
        defaults: {
            broker: {value:"",required:true},
            port: {value:1883,required:true,validate:RED.validators.number()},
            tls: {type:"tls-config",required: false},
            clientid: {value:"", validate: function(v) {
                    if ($("#node-config-input-clientid").length) {
                        // Currently editing the node
                        return $("#node-config-input-cleansession").is(":checked") || (v||"").length > 0;
                    } else {
                        return (this.cleansession===undefined || this.cleansession) || (v||"").length > 0;
                    }
                }},
            usetls: {value: false},
            verifyservercert: { value: false},
            compatmode: { value: true},
            keepalive: {value:60,validate:RED.validators.number()},
            cleansession: {value: true},
            willTopic: {value:""},
            willQos: {value:"0"},
            willRetain: {value:false},
            willPayload: {value:""},
            birthTopic: {value:""},
            birthQos: {value:"0"},
            birthRetain: {value:false},
            birthPayload: {value:""}
        },
        credentials: {
            user: {type:"text"},
            password: {type: "password"}
        },
        label: function() {
            var b = this.broker;
            if (b === "") { b = "undefined"; }
            return (this.clientid?this.clientid+"@":"")+b+":"+this.port;
        },
        oneditprepare: function () {
            var tabs = RED.tabs.create({
                id: "node-config-mqtt-broker-tabs",
                onchange: function(tab) {
                    $("#node-config-mqtt-broker-tabs-content").children().hide();
                    $("#" + tab.id).show();
                }
            });
            tabs.addTab({
                id: "mqtt-broker-tab-connection",
                label: this._("mqtt.tabs-label.connection")
            });
            tabs.addTab({
                id: "mqtt-broker-tab-security",
                label: this._("mqtt.tabs-label.security")
            });
            tabs.addTab({
                id: "mqtt-broker-tab-birth",
                label: this._("mqtt.tabs-label.birth")
            });
            tabs.addTab({
                id: "mqtt-broker-tab-will",
                label: this._("mqtt.tabs-label.will")
            });
            setTimeout(function() { tabs.resize()},0);
            if (typeof this.cleansession === 'undefined') {
                this.cleansession = true;
                $("#node-config-input-cleansession").prop("checked",true);
            }
            if (typeof this.usetls === 'undefined') {
                this.usetls = false;
                $("#node-config-input-usetls").prop("checked",false);
            }
            if (typeof this.compatmode === 'undefined') {
                this.compatmode = true;
                $("#node-config-input-compatmode").prop('checked', true);
            }
            if (typeof this.keepalive === 'undefined') {
                this.keepalive = 15;
                $("#node-config-input-keepalive").val(this.keepalive);
            }
            if (typeof this.willQos === 'undefined') {
                this.willQos = "0";
                $("#node-config-input-willQos").val("0");
            }
            if (typeof this.birthQos === 'undefined') {
                this.birthQos = "0";
                $("#node-config-input-birthQos").val("0");
            }

            function updateTLSOptions() {
                if ($("#node-config-input-usetls").is(':checked')) {
                    $("#node-config-row-tls").show();
                } else {
                    $("#node-config-row-tls").hide();
                }
            }
            updateTLSOptions();
            $("#node-config-input-usetls").on("click",function() {
                updateTLSOptions();
            });
            var node = this;
            function updateClientId() {
                if ($("#node-config-input-cleansession").is(":checked")) {
                    $("#node-config-input-clientid").attr("placeholder",node._("mqtt.placeholder.clientid"));
                } else {
                    $("#node-config-input-clientid").attr("placeholder",node._("mqtt.placeholder.clientid-nonclean"));
                }
                $("#node-config-input-clientid").change();
            }
            setTimeout(updateClientId,0);
            $("#node-config-input-cleansession").on("click",function() {
                updateClientId();
            });
        },
        oneditsave: function() {
            if (!$("#node-config-input-usetls").is(':checked')) {
                $("#node-config-input-tls").val("");
            }
        }
    });
</script>


<!--
 MQTT Broker: Darstellung
-->

<script type="text/x-red" data-template-name="test-mqtt-broker">
    <div class="form-row">
        <ul style="background: #fff; min-width: 600px; margin-bottom: 20px;" id="node-config-mqtt-broker-tabs"></ul>
    </div>
    <div id="node-config-mqtt-broker-tabs-content" style="min-height: 170px;">
        <div id="mqtt-broker-tab-connection" style="display:none">
            <div class="form-row node-input-broker">
                <label for="node-config-input-broker"><i class="fa fa-globe"></i> <span data-i18n="mqtt.label.broker"></span></label>
                <input class="input-append-left" type="text" id="node-config-input-broker" placeholder="e.g. localhost" style="width: 40%;" >
                <label for="node-config-input-port" style="margin-left: 10px; width: 35px; "> <span data-i18n="mqtt.label.port"></span></label>
                <input type="text" id="node-config-input-port" data-i18n="[placeholder]mqtt.label.port" style="width:45px">
            </div>
            <div class="form-row">
                <input type="checkbox" id="node-config-input-usetls" style="display: inline-block; width: auto; vertical-align: top;">
                <label for="node-config-input-usetls" style="width: auto" data-i18n="mqtt.label.use-tls"></label>
                <div id="node-config-row-tls" class="hide">
                    <label style="width: auto; margin-left: 20px; margin-right: 10px;" for="node-config-input-tls"><span data-i18n="mqtt.label.tls-config"></span></label><input style="width: 300px;" type="text" id="node-config-input-tls">
                </div>
            </div>
            <div class="form-row">
                <label for="node-config-input-clientid"><i class="fa fa-tag"></i> <span data-i18n="mqtt.label.clientid"></span></label>
                <input type="text" id="node-config-input-clientid" data-i18n="[placeholder]mqtt.placeholder.clientid">
            </div>
            <div class="form-row">
                <label for="node-config-input-keepalive" style="width: auto"><i class="fa fa-clock-o"></i> <span data-i18n="mqtt.label.keepalive"></span></label>
                <input type="text" id="node-config-input-keepalive" style="width: 50px">
                <input type="checkbox" id="node-config-input-cleansession" style="margin-left: 30px; height: 1em;display: inline-block; width: auto; vertical-align: middle;">
                <label for="node-config-input-cleansession" style="width: auto;" data-i18n="mqtt.label.cleansession"></label>
            </div>
            <div class="form-row">
                <input type="checkbox" id="node-config-input-compatmode" style="display: inline-block; width: auto; vertical-align: top;">
                <label for="node-config-input-compatmode" style="width: auto;" data-i18n="mqtt.label.compatmode"></label>
            </div>
        </div>
        <div id="mqtt-broker-tab-security" style="display:none">
            <div class="form-row">
                <label for="node-config-input-user"><i class="fa fa-user"></i> <span data-i18n="common.label.username"></span></label>
                <input type="text" id="node-config-input-user">
            </div>
            <div class="form-row">
                <label for="node-config-input-password"><i class="fa fa-lock"></i> <span data-i18n="common.label.password"></span></label>
                <input type="password" id="node-config-input-password">
            </div>
        </div>
        <div id="mqtt-broker-tab-birth" style="display:none">
            <div class="form-row">
                <label for="node-config-input-birthTopic"><i class="fa fa-tasks"></i> <span data-i18n="common.label.topic"></span></label>
                <input type="text" id="node-config-input-birthTopic" data-i18n="[placeholder]mqtt.placeholder.birth-topic">
            </div>
            <div class="form-row">
                <label for="node-config-input-birthQos"><i class="fa fa-empire"></i> <span data-i18n="mqtt.label.qos"></span></label>
                <select id="node-config-input-birthQos" style="width:125px !important">
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                </select>
                &nbsp;&nbsp;<i class="fa fa-history"></i>&nbsp;<span data-i18n="mqtt.retain"></span> &nbsp;<select id="node-config-input-birthRetain" style="width:125px !important">
                    <option value="false" data-i18n="mqtt.false"></option>
                    <option value="true" data-i18n="mqtt.true"></option>
                </select>
            </div>
            <div class="form-row">
                <label for="node-config-input-birthPayload"><i class="fa fa-envelope"></i> <span data-i18n="common.label.payload"></span></label>
                <input type="text" id="node-config-input-birthPayload" data-i18n="[placeholder]common.label.payload">
            </div>
        </div>
        <div id="mqtt-broker-tab-will" style="display:none">
            <div class="form-row">
                <label for="node-config-input-willTopic"><i class="fa fa-tasks"></i> <span data-i18n="common.label.topic"></span></label>
                <input type="text" id="node-config-input-willTopic" data-i18n="[placeholder]mqtt.placeholder.will-topic">
            </div>
            <div class="form-row">
                <label for="node-config-input-willQos"><i class="fa fa-empire"></i> <span data-i18n="mqtt.label.qos"></span></label>
                <select id="node-config-input-willQos" style="width:125px !important">
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                </select>
                &nbsp;&nbsp;<i class="fa fa-history"></i>&nbsp;<span data-i18n="mqtt.retain"></span> &nbsp;<select id="node-config-input-willRetain" style="width:125px !important">
                    <option value="false" data-i18n="mqtt.false"></option>
                    <option value="true" data-i18n="mqtt.true"></option>
                </select>
            </div>
            <div class="form-row">
                <label for="node-config-input-willPayload"><i class="fa fa-envelope"></i> <span data-i18n="common.label.payload"></span></label>
                <input type="text" id="node-config-input-willPayload" data-i18n="[placeholder]common.label.payload">
            </div>
        </div>
    </div>
</script>


<!--
 MQTT Broker: Hilfetext
-->

<script type="text/x-red" data-help-name="test-mqtt-broker">
    <p>A minimum MQTT broker connection requires only a broker server address to be added to the default configuration.</p>
    <p>To secure the connection with SSL/TLS, a TLS Configuration must also be configured and selected.</p>
    <p>If you create a Client ID it must be unique to the broker you are connecting to.</p>
    <p>For more information about MQTT see the <a href="http://www.eclipse.org/paho/" target="_blank">Eclipse Paho</a> site.</p>
</script>



