

<script type="text/javascript">

    RED.nodes.registerType('IoT-Sensor',{
        category: 'config',
        defaults: {
            IoTSensorName: {value:"",required:true},
        },
        label: function() {
            return this.IoTSensorName;
        }
    });
</script>

<script type="text/x-red" data-template-name="IoT-Sensor">
    <div class="form-row">
        <label for="node-config-input-IoT-Sensor"><i class="icon-bookmark"></i> Sensor </label>
        <input type="text" id="node-config-input-IoTSensorName" placeholder="z.B. LDR">
    </div>

</script>

<!--
 Sensor: Config 
-->
<script type="text/javascript">
    RED.nodes.registerType('Sensor',{
        category: 'input',
        defaults: {
            
            broker: {type:"mqtt-broker", required:true},
            sensor: {type:"IoT-Sensor", required:true},
            number: {value:"", required:true, validate:RED.validators.number()},
            qos: {value: "1"},
            name: {value:""},
            topic:{value:""},
            
        },
        color:"#3FADB5",
        inputs:0,
        outputs:1,
        icon: "feed.png",
        label: function() {
            return this.name||"Sensor";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        
        oneditprepare: function() {
            if (this.qos === undefined) {
                $("#node-input-qos").val("1");
            }
        }
    });
</script>


<!--
 Sensor: Darstellung
<input type="text" id="node-input-name" placeholder="z.B. LDR2">
-->
<script type="text/x-red" data-template-name="Sensor">

    <div class="form-row">
    
        <label for="node-input-broker">
            <i class="fa fa-globe"></i> 
            <span data-i18n="mqtt.label.broker"></span>
        </label>
        
        <input type="text" id="node-input-broker">
        
    </div>
    
    <div class="form-row">
    
        <label for="node-input-sensor">
            <i class="fa fa-thermometer-3"></i>
            Sensor
        </label>
        
        <input type="text" id="node-input-sensor">
     </div>
     
    <div class="form-row">
        <label for="node-input-number">
            <i class="fa fa-hashtag"></i> 
            Nummer
        </label>
     
        <input type="text" id="node-input-number" placeholder="z.B. 5">
        
    </div>
    
    <div class="form-row">
    
        <label for="node-input-qos">
            <i class="fa fa-empire"></i>
            <span data-i18n="mqtt.label.qos"></span>
        </label>
        <select id="node-input-qos" style="width:125px !important">
            //Anfang
            <option value="0">0</option>
            <option value="1">1</option>
        </select>
        
    </div>
    
    <div class="form-row">
    
        <label for="node-input-name">
            <i class="fa fa-tag"></i>
            Name
        </label>
        
        <input type="text" id="node-input-name" placeholder="z.B. Temperatur Flur oder TMP5">
        
    </div>
    

    
    
</script>

<!--
 Sensor: Hilfe Text
-->
<script type="text/x-red" data-help-name="Sensor">
    <p>Verbindet sich mit dem Broker und empfängt Daten vom Sensor.</p>
    
    <p>Zunächst müssen MQTT-Broker, Sensortyp und die Sensornummer spezifiziert werden. Beispiele für
    die Sensorenkonfiguratioen wären Termometer1, Wetterstation9 oder Knopf0. Die akutell im Netzwerk verfügbaren Sensoren findest du unter http://[IP-Adresse_des_Servers]/mqttdb.php</p>
    
    <p>Der Sensor-Knoten gibt folgende Parameter aus:</p>
    <ul>
       <li><code>msg.topic</code></li>
       <li><code>msg.payload</code></li>
       <li><code>msg.qos</code></li>
       <li><code>msg.retain</code></li>
    </ul>
    
    <p>Mittels <code>msg.topic</code> kannst du feststellen, unter welchem Topic die Nachricht versendet wurde. Das Topic hat i.d.R die Form /esp/sensor/NAME+NUMMER</p>
    
    <p>Die interessanten Daten befindet sich im <code>msg.payload</code>. Der Payload wird bei Empfang in ein <strong>JSON Objekt</strong> umgewandelt. Dies ermöglicht es dir den Inhalt der Nachricht unkompliziert auszuwerten und weiter zu verwenden. So kannst du beispielsweise, wenn du weißt, dass der Parameter "Temperatur" im Payload vorhanden ist, diesen über <code>msg.payload.Temperatur</code> auslesen.</p>
    
    <p><code>msg.qos</code> zeigt an mit welchem Aufwand der Sensor versucht hat die Nachricht zum Broker zu senden. Quality of Service 0 bedeutet, dass der Sensor die Nachricht genau ein einziges Mal versendet hat. Ob die Nachricht beim Broker angekommen ist, interessiert den Senosr nicht. QoS 1 bedeutet widerum, dass der Sensor auf eine Empfangsbestätigung vom Broker wartet. So sendet der Sensor so lange ein und die selbe Nachricht bis er sich sicher sein kann, dass diese auch angekommen ist. </p>
    
    <p>Der Parameter <code>msg.retain</code> gibt an, ob der Sensor sich vom Broker wünscht die letzte Nachricht zu archivieren.</p>
</script>





<script type="text/javascript">

    RED.nodes.registerType('IoT-Aktor',{
        category: 'config',
        defaults: {
            IoTAktorName: {value:"",required:true},
        },
        label: function() {
            return this.IoTAktorName;
        }
    });
</script>

<script type="text/x-red" data-template-name="IoT-Aktor">
    <div class="form-row">
        <label for="node-config-input-IoT-Aktor"><i class="icon-bookmark"></i> Aktor </label>
        <input type="text" id="node-config-input-IoTAktorName" placeholder="z.B. LED oder Servo">
    </div>

</script>


<!--
 Aktor: Config
-->
<script type="text/javascript">
    RED.nodes.registerType('Aktor',{
        category: 'output',
        defaults: {
            
            broker: {type:"mqtt-broker", required:true},
            aktor: {type:"IoT-Aktor", required:true},
            number: {value:"", required:true, validate:RED.validators.number()},
            qos: {value: "1"},
            name: {value:""},
            topic:{value:""},
            retain: {value:true},

        },
        color:"#3FADB5",
        inputs:1,
        outputs:0,
        icon: "feed.png",
        align: "right",
        label: function() {
            return this.name||"Aktor";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });
</script>



<!--
 MQTT Ausgang: Darstellung
-->


<script type="text/x-red" data-template-name="Aktor">

    <div class="form-row">
    
        <label for="node-input-broker">
            <i class="fa fa-globe"></i> 
            <span data-i18n="mqtt.label.broker"></span>
        </label>
        
        <input type="text" id="node-input-broker">
        
    </div>
    
    <div class="form-row">
    
        <label for="node-input-aktor">
            <i class="fa fa-gears"></i>
            Aktor
        </label>
        
        <input type="text" id="node-input-aktor">
     </div>
     
    <div class="form-row">
        <label for="node-input-number">
            <i class="fa fa-hashtag"></i> 
            Nummer
        </label>
     
        <input type="text" id="node-input-number" placeholder="z.B. 7">
        
    </div>
    
    <div class="form-row">
    
        <label for="node-input-qos">
            <i class="fa fa-empire"></i>
            <span data-i18n="mqtt.label.qos"></span>
        </label>
        <select id="node-input-qos" style="width:125px !important">
            <option value="0">0</option>
            <option value="1">1</option>
        </select>
        
    </div>
    
    <div class="form-row" id="node-retain">
        <label for="node-input-retain">
            <i class="fa fa-cloud" aria-hidden="true"></i>
            Retained
        </label>

        <input type="checkbox" id="node-input-retain" style="display: inline-block; width: auto; vertical-align: top;">

    </div>
    
    <div class="form-row">
    
        <label for="node-input-name">
            <i class="fa fa-tag"></i>
            Name
        </label>
        
        <input type="text" id="node-input-name" placeholder="z.B. LED-Strip oder Servo7">
        
    </div>
    
    
    <div class="form-tips">HIER KÖNNTE IHR TIPP STEHEN</span></div>
</script>

<!--
 MQTT Ausgang: Hilfe Text
-->

<script type="text/x-red" data-help-name="Aktor">
    <p>Verbindet sich mit dem Broker und sendet den im Eingang definierten <code>msg.payload</code> an einen Aktor.</p>
    
    <p>Zunächst müssen MQTT-Broker, Aktortyp und die Aktornummer spezifiziert werden. Beispiele für
    die Aktorkonfiguratioen wären LED9, Motor12 oder Servo12. Die akutell im Netzwerk verfügbaren Aktoren findest du unter http://[IP-Adresse_des_Servers]/mqttdb.php</p>
    
    <p>Um eine Nachricht an den Aktor zu versenden, müssen folgende Parameter übergeben werden:</p>
    <ul>
       <li><code>msg.topic</code></li>
       <li><code>msg.payload</code></li>
       <li><code>msg.qos</code></li>
       <li><code>msg.retain</code></li>
    </ul>
    
    <p>Der Aktor-Knoten nimmt dir an dieser Stelle etwas Arbeit ab, indem er <code>msg.topic</code>, <code>msg.qos</code> und <code>msg.retain</code> selbst setzt. </p>
    
    <p>Deine Aufgabe ist es <code>msg.payload</code> sinnvoll zu setzen. Dabei sind einige Dinge zu beachten. Zum einen muss der Payload der Nachricht als <strong>JSON Objekt</strong> oder als <strong>JSON String</strong> vorliegen. Ein gültiger Payload sieht z.B. so aus:</p>
    
    <p><samp>{"Parameter_1":"Hallo", "Parameter_2":"IoT-Welt"} oder {"Stellwert":7,"Dauer":4}</samp></p>
    
    <p> Zum anderen musst du dich erkundigen, welche Eingabeparameter dein Aktor genau benötigt. Versendest du z.B. den Parameter "Drehzahl" an eine Lampe, kann diese nichts mit diesen Informationen anfangen!</p>
    
    <p><em>"Was der Aktor nicht kennt, das frisst er nicht!"</em></p>
</script>





<script type="text/javascript">
    RED.nodes.registerType('Config',{
        category: 'output',
        defaults: {
            
            broker: {type:"mqtt-broker", required:true},
            aktor: {type:"IoT-Aktor"},
            sensor: {type:"IoT-Sensor"},
            number: {value:"", required:true, validate:RED.validators.number()},
            qos: {value: "1"},
            toConfig: {value: "", required:true},
            name: {value:""},
            topic:{value:""},
            retain: {value:false},

        },
        color:"#3FADB5",
        inputs:1,
        outputs:1,
        icon: "feed.png",
        align: "right",
        label: function() {
            return this.name||"Config";
        },
        //----//
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function(){
            var updateOptions = function(){
                var typ = $("#node-input-to_Config").val();
                if(typ == "Sensor"){
                    $("#inject-IoT-Devices-Aktor").hide();
                    $("#inject-IoT-Devices-Sensor").show();
                } else {
                    this.toConfig = "Aktor";
                    $("#inject-IoT-Devices-Aktor").show();
                    $("#inject-IoT-Devices-Sensor").hide();
                }          
            };
            updateOptions();
            $("#node-input-to_Config").change(updateOptions);
            $("#node-input-aktor").change(updateOptions);
            $("#node-input-sensor").change(updateOptions);
            
        },
        oneditsave: function() {
            var typ = $("#node-input-to_Config").val();
            if(typ == "Sensor"){
                this.toConfig = "Sensor";
            } else {
                this.toConfig = "Aktor";
            }
        }
/*
            $(".inject-IoT-Devices").hide();
            $("#inject-IoT-Devices-"+ $("#node-input-to_Config").val()).show();
            
            $("#node-input-to_Config").change(function() {
            var d = $("#node-input-to_Config").val();   
            $(".inject-IoT-Devices").hide();
            $("#inject-IoT-Devices-"+d).show();
            });
*/
        //---------------//
    
    });
</script>

<script type="text/x-red" data-template-name="Config">

    <div class="form-row">
    
        <label for="node-input-broker">
            <i class="fa fa-globe"></i> 
            <span data-i18n="mqtt.label.broker"></span>
        </label>
        
        <input type="text" id="node-input-broker">
        
    </div>
    
    <div class="form-row">
    
        <label for="node-input-to_Config">
            <i class="fa fa-empire"></i>
            Sende Update an:
        </label>
        <select id="node-input-to_Config" style="width:125px !important">
            <option value="Sensor"> Sensor</option>
            <option value="Aktor"> Aktor</option>
        </select>
        
    </div>
    
    <div class="form-row hidden" id="inject-IoT-Devices-Aktor">
    
        <label for="node-input-aktor">
            <i class="fa fa-gears"></i>
            Aktor
        </label>
        
        <input type="text" id="node-input-aktor">
     </div>
     
    <div class="form-row hidden" id="inject-IoT-Devices-Sensor">
    
        <label for="node-input-sensor">
            <i class="fa fa-thermometer-3"></i>
            Sensor
        </label>
        
        <input type="text" id="node-input-sensor">
     </div>     
     
    <div class="form-row">
        <label for="node-input-number">
            <i class="fa fa-hashtag"></i> 
            Nummer
        </label>
     
        <input type="text" id="node-input-number" placeholder="z.B. 7">
        
    </div>
                
    <div class="form-row">
    
        <label for="node-input-qos">
            <i class="fa fa-empire"></i>
            <span data-i18n="mqtt.label.qos"></span>
        </label>
        <select id="node-input-qos" style="width:125px !important">
            <option value="0">0</option>
            <option value="1">1</option>
        </select>
        
    </div>
    
    <div class="form-row" id="node-retain">
        <label for="node-input-retain">
            <i class="fa fa-cloud" aria-hidden="true"></i>
            Retained
        </label>

        <input type="checkbox" id="node-input-retain" style="display: inline-block; width: auto; vertical-align: top;">

    </div>
    
    <div class="form-row">
    
        <label for="node-input-name">
            <i class="fa fa-tag"></i>
            Name
        </label>
        
        <input type="text" id="node-input-name" placeholder="z.B. LED-Strip oder Servo7">
        
    </div>
    
    
    <div class="form-tips">HIER KÖNNTE IHR TIPP STEHEN</span></div>
</script>

<!--
 MQTT Ausgang: Hilfe Text
-->

<script type="text/x-red" data-help-name="Config">
    <p>Blabla</p>
    
</script>



<! AN -->

<script type="text/x-red" data-template-name="An">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Power On">
    </div>
</script>


<!-- Next, some simple help text is provided for the node.                   -->
<script type="text/x-red" data-help-name="An">
   <p>Dieser Node wandelt einen beliebigen Eingang in ein Einschalten-Befehl um.</p>
</script>

<!-- Finally, the node type is registered along with all of its properties   -->
<!-- The example below shows a small subset of the properties that can be set-->
<script type="text/javascript">
    RED.nodes.registerType('An',{
        category: 'IoT2School',      // the palette category
        defaults: {             // defines the editable properties of the node
            name: {value:""},   //  along with default values.
        },
	    color:"#91F5D7",
        inputs:1,               // set the number of inputs - only 0 or 1
        outputs:1,              // set the number of outputs - 0 to n
        // set the icon (held in icons dir below where you save the node)
        icon: "light.png",     // saved in  icons/myicon.png
        label: function() {     // sets the default label contents
            return this.name||"AN";
        },
        labelStyle: function() { // sets the class to apply to the label
            return this.name?"node_label_italic":"";
        }
    });
</script>

<! AUS -->

<script type="text/x-red" data-template-name="Aus">
   <!-- data-template-name identifies the node type this is for              -->

   <!-- Each of the following divs creates a field in the edit dialog.       -->
   <!-- Generally, there should be an input for each property of the node.   -->
   <!-- The for and id attributes identify the corresponding property        -->
   <!-- (with the 'node-input-' prefix).                                     -->
   <!-- The available icon classes are defined Font Awesome Icons (FA Icons) -->

    <br/>
    <!-- By convention, most nodes have a 'name' property. The following div -->
    <!-- provides the necessary field. Should always be the last option      -->
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Power Off">
    </div>
</script>


<!-- Next, some simple help text is provided for the node.                   -->
<script type="text/x-red" data-help-name="Aus">
   <!-- data-help-name identifies the node type this help is for             -->
   <!-- This content appears in the Info sidebar when a node is selected     -->
   <!-- The first <p> is used as the pop-up tool tip when hovering over a    -->
   <!-- node in the palette.                                                 -->
   <p>Simple sample input node. Just sends a single message when it starts up.
   This is not very useful.</p>
   <p>Outputs an object called <code>msg</code> containing <code>msg.topic</code> and
   <code>msg.payload</code>. msg.payload is a String.</p>
</script>

<!-- Finally, the node type is registered along with all of its properties   -->
<!-- The example below shows a small subset of the properties that can be set-->
<script type="text/javascript">
    RED.nodes.registerType('Aus',{
        category: 'IoT2School',      // the palette category
        defaults: {             // defines the editable properties of the node
            name: {value:""},   //  along with default values.
        },
	color:"#3FADB5",
        inputs:1,               // set the number of inputs - only 0 or 1
        outputs:1,              // set the number of outputs - 0 to n
        // set the icon (held in icons dir below where you save the node)
        icon: "myicon.png",     // saved in  icons/myicon.png
        label: function() {     // sets the default label contents
            return this.name||"AUS";
        },
        labelStyle: function() { // sets the class to apply to the label
            return this.name?"node_label_italic":"";
        }
    });
</script>


<! TOGGLE -->

<script type="text/x-red" data-template-name="Toggle">
   <!-- data-template-name identifies the node type this is for              -->

   <!-- Each of the following divs creates a field in the edit dialog.       -->
   <!-- Generally, there should be an input for each property of the node.   -->
   <!-- The for and id attributes identify the corresponding property        -->
   <!-- (with the 'node-input-' prefix).                                     -->
   <!-- The available icon classes are defined Font Awesome Icons (FA Icons) -->

    <br/>
    <!-- By convention, most nodes have a 'name' property. The following div -->
    <!-- provides the necessary field. Should always be the last option      -->
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Toggle Power">
    </div>
</script>


<!-- Next, some simple help text is provided for the node.                   -->
<script type="text/x-red" data-help-name="Toggle">
   <!-- data-help-name identifies the node type this help is for             -->
   <!-- This content appears in the Info sidebar when a node is selected     -->
   <!-- The first <p> is used as the pop-up tool tip when hovering over a    -->
   <!-- node in the palette.                                                 -->
   <p>Simple sample input node. Just sends a single message when it starts up.
   This is not very useful.</p>
   <p>Outputs an object called <code>msg</code> containing <code>msg.topic</code> and
   <code>msg.payload</code>. msg.payload is a String.</p>
</script>

<!-- Finally, the node type is registered along with all of its properties   -->
<!-- The example below shows a small subset of the properties that can be set-->
<script type="text/javascript">
    RED.nodes.registerType('Toggle',{
        category: 'IoT2School',      // the palette category
        defaults: {             // defines the editable properties of the node
        name: {value:""},   //  along with default values.
        },
	   color:"#3FADB5",
        inputs:1,               // set the number of inputs - only 0 or 1
        outputs:1,              // set the number of outputs - 0 to n
        // set the icon (held in icons dir below where you save the node)
        icon: "myicon.png",     // saved in  icons/myicon.png
        label: function() {     // sets the default label contents
            return this.name||"Toggli";
        },
        labelStyle: function() { // sets the class to apply to the label
            return this.name?"node_label_italic":"";
        }
    });
</script>

<! RGB -->

<script type="text/x-red" data-template-name="RGB">
   <!-- data-template-name identifies the node type this is for              -->

   <!-- Each of the following divs creates a field in the edit dialog.       -->
   <!-- Generally, there should be an input for each property of the node.   -->
   <!-- The for and id attributes identify the corresponding property        -->
   <!-- (with the 'node-input-' prefix).                                     -->
   <!-- The available icon classes are defined Font Awesome Icons (FA Icons) -->

 
    <!-- By convention, most nodes have a 'name' property. The following div -->
    <!-- provides the necessary field. Should always be the last option      -->
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>

    <div class="form-row">
        <label for="node-input-rot"><i class="fa fa-tag"></i> Rot</label>
        <input type="text" id="node-input-rot" placeholder="0..255">
    </div>

    <div class="form-row">
        <label for="node-input-gruen"><i class="fa fa-tag"></i> Grün</label>
        <input type="text" id="node-input-gruen" placeholder="0..255">
    </div>

    <div class="form-row">
        <label for="node-input-blau"><i class="fa fa-tag"></i> Blau</label>
        <input type="text" id="node-input-blau" placeholder="0..255">
    </div>
</script>


<!-- Next, some simple help text is provided for the node.                   -->
<script type="text/x-red" data-help-name="RGB">
   <!-- data-help-name identifies the node type this help is for             -->
   <!-- This content appears in the Info sidebar when a node is selected     -->
   <!-- The first <p> is used as the pop-up tool tip when hovering over a    -->
   <!-- node in the palette.                                                 -->
   <p>Simple sample input node. Just sends a single message when it starts up.
   This is not very useful.</p>
   <p>Outputs an object called <code>msg</code> containing <code>msg.topic</code> and
   <code>msg.payload</code>. msg.payload is a String.</p>
</script>

<!-- Finally, the node type is registered along with all of its properties   -->
<!-- The example below shows a small subset of the properties that can be set-->
<script type="text/javascript">
    RED.nodes.registerType('RGB',{
        category: 'IoT2School',      // the palette category
        defaults: {             // defines the editable properties of the node
	    rot: {value:"0",validate:RED.validators.number(), required:true},
	    gruen: {value:"0", validate:RED.validators.number(), required:true},
	    blau: {value:"0",validate:RED.validators.number(), required:true},
            name: {value:""},   //  along with default values.
        },
	   color:"#3FADB5",
        inputs:1,               // set the number of inputs - only 0 or 1
        outputs:1,              // set the number of outputs - 0 to n
        // set the icon (held in icons dir below where you save the node)
        icon: "myicon.png",     // saved in  icons/myicon.png
        label: function() {     // sets the default label contents
	    var rgb_name = "rgb(" + this.rot + ","+ this.gruen + ","+ this.blau+")";
            return this.name||rgb_name ;
		//'['this.rot+','+this.gruen+','+ this.blau +']';
        },
        labelStyle: function() { // sets the class to apply to the label
            return this.name?"node_label_italic":"";
        }
    });
</script>

<! BRIGHTNESS -->

<script type="text/x-red" data-template-name="Brightness">
   <!-- data-template-name identifies the node type this is for              -->

   <!-- Each of the following divs creates a field in the edit dialog.       -->
   <!-- Generally, there should be an input for each property of the node.   -->
   <!-- The for and id attributes identify the corresponding property        -->
   <!-- (with the 'node-input-' prefix).                                     -->
   <!-- The available icon classes are defined Font Awesome Icons (FA Icons) -->

    <br/>
    <!-- By convention, most nodes have a 'name' property. The following div -->
    <!-- provides the necessary field. Should always be the last option      -->
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-brightness"><i class="fa fa-tag"></i> Helligkeit</label>
        <input type="text" id="node-input-brightness" placeholder="0..100">
    </div>
</script>


<!-- Next, some simple help text is provided for the node.                   -->
<script type="text/x-red" data-help-name="Brightness">
   <!-- data-help-name identifies the node type this help is for             -->
   <!-- This content appears in the Info sidebar when a node is selected     -->
   <!-- The first <p> is used as the pop-up tool tip when hovering over a    -->
   <!-- node in the palette.                                                 -->
   <p>Simple sample input node. Just sends a single message when it starts up.
   This is not very useful.</p>
   <p>Outputs an object called <code>msg</code> containing <code>msg.topic</code> and
   <code>msg.payload</code>. msg.payload is a String.</p>
</script>

<!-- Finally, the node type is registered along with all of its properties   -->
<!-- The example below shows a small subset of the properties that can be set-->
<script type="text/javascript">
    RED.nodes.registerType('Brightness',{
        category: 'IoT2School',      // the palette category
        defaults: {             // defines the editable properties of the node
	       brightness: {value:"0",validate:RED.validators.number(),           required:true},
            name: {value:""},   //  along with default values.
        },
	    color:"#91F5D7",
        inputs:1,               // set the number of inputs - only 0 or 1
        outputs:1,              // set the number of outputs - 0 to n
        // set the icon (held in icons dir below where you save the node)
        icon: "myicon.png",     // saved in  icons/myicon.png
        label: function() {     // sets the default label contents
            return this.name||this.brightness||"Helligkeit";
        },
        labelStyle: function() { // sets the class to apply to the label
            return this.name?"node_label_italic":"";
        }
    });
</script>


<! Click -->

<script type="text/x-red" data-template-name="Click">
   <!-- data-template-name identifies the node type this is for              -->

   <!-- Each of the following divs creates a field in the edit dialog.       -->
   <!-- Generally, there should be an input for each property of the node.   -->
   <!-- The for and id attributes identify the corresponding property        -->
   <!-- (with the 'node-input-' prefix).                                     -->
   <!-- The available icon classes are defined Font Awesome Icons (FA Icons) -->

    <br/>
    <!-- By convention, most nodes have a 'name' property. The following div -->
    <!-- provides the necessary field. Should always be the last option      -->
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>

</script>


<!-- Next, some simple help text is provided for the node.                   -->
<script type="text/x-red" data-help-name="Click">
   <!-- data-help-name identifies the node type this help is for             -->
   <!-- This content appears in the Info sidebar when a node is selected     -->
   <!-- The first <p> is used as the pop-up tool tip when hovering over a    -->
   <!-- node in the palette.                                                 -->
   <p>Simple sample input node. Just sends a single message when it starts up.
   This is not very useful.</p>
   <p>Outputs an object called <code>msg</code> containing <code>msg.topic</code> and
   <code>msg.payload</code>. msg.payload is a String.</p>
</script>

<!-- Finally, the node type is registered along with all of its properties   -->
<!-- The example below shows a small subset of the properties that can be set-->
<script type="text/javascript">
    RED.nodes.registerType("Click",{
        category: 'IoT2School',      // the palette category
        defaults: {             // defines the editable properties of the node
	       brightness: {value:"0",validate:RED.validators.number(),           required:true},
            name: {value:""},   //  along with default values.
        },
	    color:"#91F5D7",
        inputs:1,               // set the number of inputs - only 0 or 1
        outputs:4,              // set the number of outputs - 0 to n
        outputLabels: ["singleClick","doubleClick","longPress","longRelease"],
        // set the icon (held in icons dir below where you save the node)
        icon: "myicon.png",     // saved in  icons/myicon.png
        label: function() {     // sets the default label contents
            return this.name||this.brightness||"Helligkeit";
        },
        labelStyle: function() { // sets the class to apply to the label
            return this.name?"node_label_italic":"";
        }
    });
</script>



























<script type="text/x-red" data-template-name="iot-mqtt-broker">
    <div class="form-row">
        <ul style="background: #fff; min-width: 600px; margin-bottom: 20px;" id="node-config-iot-mqtt-broker-tabs"></ul>
    </div>
    <div id="node-config-iot-mqtt-broker-tabs-content" style="min-height: 170px;">
        <div id="mqtt-broker-tab-connection" style="display:none">
            <div class="form-row node-input-broker">
                <label for="node-config-input-iot-broker"><i class="fa fa-globe"></i> <span data-i18n="mqtt.label.broker"></span></label>
                <input class="input-append-left" type="text" id="node-config-input-broker" placeholder="e.g. localhost" style="width:40%;" >
                <label for="node-config-input-port" style="margin-left:20px; width:35px; "> <span data-i18n="mqtt.label.port"></span></label>
                <input type="text" id="node-config-input-port" data-i18n="[placeholder]mqtt.label.port" style="width:55px">
            </div>
            <div class="form-row">
                <input type="checkbox" id="node-config-input-usetls" style="display: inline-block; width: auto; vertical-align: top;">
                <label for="node-config-input-usetls" style="width: auto" data-i18n="mqtt.label.use-tls"></label>
                <div id="node-config-row-tls" class="hide">
                    <label style="width: auto; margin-left: 20px; margin-right: 10px;" for="node-config-input-tls"><span data-i18n="mqtt.label.tls-config"></span></label><input style="width: 300px;" type="text" id="node-config-input-tls">
                </div>
            </div>
            <div class="form-row">
                <label for="node-config-input-clientid"><i class="fa fa-tag"></i> <span data-i18n="mqtt.label.clientid"></span></label>
                <input type="text" id="node-config-input-clientid" data-i18n="[placeholder]mqtt.placeholder.clientid">
            </div>
            <div class="form-row">
                <label for="node-config-input-keepalive" style="width: auto"><i class="fa fa-clock-o"></i> <span data-i18n="mqtt.label.keepalive"></span></label>
                <input type="text" id="node-config-input-keepalive" style="width: 50px">
                <input type="checkbox" id="node-config-input-cleansession" style="margin-left: 30px; height: 1em;display: inline-block; width: auto; vertical-align: middle;">
                <label for="node-config-input-cleansession" style="width: auto;" data-i18n="mqtt.label.cleansession"></label>
            </div>
            <div class="form-row">
                <input type="checkbox" id="node-config-input-compatmode" style="display: inline-block; width: auto; vertical-align: top;">
                <label for="node-config-input-compatmode" style="width: auto;" data-i18n="mqtt.label.compatmode"></label>
            </div>
        </div>
        <div id="mqtt-broker-tab-security" style="display:none">
            <div class="form-row">
                <label for="node-config-input-user"><i class="fa fa-user"></i> <span data-i18n="common.label.username"></span></label>
                <input type="text" id="node-config-input-user">
            </div>
            <div class="form-row">
                <label for="node-config-input-password"><i class="fa fa-lock"></i> <span data-i18n="common.label.password"></span></label>
                <input type="password" id="node-config-input-password">
            </div>
        </div>
        <div id="mqtt-broker-tab-birth" style="display:none">
            <div class="form-row">
                <label for="node-config-input-birthTopic"><i class="fa fa-tasks"></i> <span data-i18n="common.label.topic"></span></label>
                <input type="text" id="node-config-input-birthTopic" data-i18n="[placeholder]mqtt.placeholder.birth-topic">
            </div>
            <div class="form-row">
                <label for="node-config-input-birthQos"><i class="fa fa-empire"></i> <span data-i18n="mqtt.label.qos"></span></label>
                <select id="node-config-input-birthQos" style="width:125px !important">
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                </select>
                &nbsp;&nbsp;<i class="fa fa-history"></i>&nbsp;<span data-i18n="mqtt.retain"></span> &nbsp;<select id="node-config-input-birthRetain" style="width:125px !important">
                    <option value="false" data-i18n="mqtt.false"></option>
                    <option value="true" data-i18n="mqtt.true"></option>
                </select>
            </div>
            <div class="form-row">
                <label for="node-config-input-birthPayload"><i class="fa fa-envelope"></i> <span data-i18n="common.label.payload"></span></label>
                <input type="text" id="node-config-input-birthPayload" data-i18n="[placeholder]common.label.payload">
            </div>
        </div>
        <div id="mqtt-broker-tab-will" style="display:none">
            <div class="form-row">
                <label for="node-config-input-willTopic"><i class="fa fa-tasks"></i> <span data-i18n="common.label.topic"></span></label>
                <input type="text" id="node-config-input-willTopic" data-i18n="[placeholder]mqtt.placeholder.will-topic">
            </div>
            <div class="form-row">
                <label for="node-config-input-willQos"><i class="fa fa-empire"></i> <span data-i18n="mqtt.label.qos"></span></label>
                <select id="node-config-input-willQos" style="width:125px !important">
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                </select>
                &nbsp;&nbsp;<i class="fa fa-history"></i>&nbsp;<span data-i18n="mqtt.retain"></span> &nbsp;<select id="node-config-input-willRetain" style="width:125px !important">
                    <option value="false" data-i18n="mqtt.false"></option>
                    <option value="true" data-i18n="mqtt.true"></option>
                </select>
            </div>
            <div class="form-row">
                <label for="node-config-input-willPayload"><i class="fa fa-envelope"></i> <span data-i18n="common.label.payload"></span></label>
                <input type="text" id="node-config-input-willPayload" data-i18n="[placeholder]common.label.payload">
            </div>
        </div>
    </div>
</script>

<script type="text/x-red" data-help-name="iot-mqtt-broker">
    <p>A minimum MQTT broker connection requires only a broker server address to be added to the default configuration.</p>
    <p>To secure the connection with SSL/TLS, a TLS Configuration must also be configured and selected.</p>
    <p>If you create a Client ID it must be unique to the broker you are connecting to.</p>
    <p>For more information about MQTT see the <a href="http://www.eclipse.org/paho/" target="_blank">Eclipse Paho</a> site.</p>
</script>

<script type="text/javascript">
    RED.nodes.registerType('iot-mqtt-broker',{
        category: 'config',
        defaults: {
            broker: {value:"",required:true},
            port: {value:1883,required:true,validate:RED.validators.number()},
            tls: {type:"tls-config",required: false},
            clientid: {value:"", validate: function(v) {
                    if ($("#node-config-input-clientid").length) {
                        // Currently editing the node
                        return $("#node-config-input-cleansession").is(":checked") || (v||"").length > 0;
                    } else {
                        return (this.cleansession===undefined || this.cleansession) || (v||"").length > 0;
                    }
                }},
            usetls: {value: false},
            verifyservercert: { value: false},
            compatmode: { value: true},
            keepalive: {value:60,validate:RED.validators.number()},
            cleansession: {value: true},
            willTopic: {value:""},
            willQos: {value:"0"},
            willRetain: {value:false},
            willPayload: {value:""},
            birthTopic: {value:""},
            birthQos: {value:"0"},
            birthRetain: {value:false},
            birthPayload: {value:""}
        },
        credentials: {
            user: {type:"text"},
            password: {type: "password"}
        },
        label: function() {
            var b = this.broker;
            if (b === "") { b = "undefined"; }
            return (this.clientid?this.clientid+"@":"")+b+":"+this.port;
        },
        oneditprepare: function () {
            var tabs = RED.tabs.create({
                id: "node-config-mqtt-broker-tabs",
                onchange: function(tab) {
                    $("#node-config-mqtt-broker-tabs-content").children().hide();
                    $("#" + tab.id).show();
                }
            });
            tabs.addTab({
                id: "mqtt-broker-tab-connection",
                label: this._("mqtt.tabs-label.connection")
            });
            tabs.addTab({
                id: "mqtt-broker-tab-security",
                label: this._("mqtt.tabs-label.security")
            });
            tabs.addTab({
                id: "mqtt-broker-tab-birth",
                label: this._("mqtt.tabs-label.birth")
            });
            tabs.addTab({
                id: "mqtt-broker-tab-will",
                label: this._("mqtt.tabs-label.will")
            });
            setTimeout(function() { tabs.resize(); },0);
            if (typeof this.cleansession === 'undefined') {
                this.cleansession = true;
                $("#node-config-input-cleansession").prop("checked",true);
            }
            if (typeof this.usetls === 'undefined') {
                this.usetls = false;
                $("#node-config-input-usetls").prop("checked",false);
            }
            if (typeof this.compatmode === 'undefined') {
                this.compatmode = true;
                $("#node-config-input-compatmode").prop('checked', true);
            }
            if (typeof this.keepalive === 'undefined') {
                this.keepalive = 15;
                $("#node-config-input-keepalive").val(this.keepalive);
            }
            if (typeof this.willQos === 'undefined') {
                this.willQos = "0";
                $("#node-config-input-willQos").val("0");
            }
            if (typeof this.birthQos === 'undefined') {
                this.birthQos = "0";
                $("#node-config-input-birthQos").val("0");
            }
            function updateTLSOptions() {
                if ($("#node-config-input-usetls").is(':checked')) {
                    $("#node-config-row-tls").show();
                } else {
                    $("#node-config-row-tls").hide();
                }
            }
            updateTLSOptions();
            $("#node-config-input-usetls").on("click",function() {
                updateTLSOptions();
            });
            var node = this;
            function updateClientId() {
                if ($("#node-config-input-cleansession").is(":checked")) {
                    $("#node-config-input-clientid").attr("placeholder",node._("mqtt.placeholder.clientid"));
                } else {
                    $("#node-config-input-clientid").attr("placeholder",node._("mqtt.placeholder.clientid-nonclean"));
                }
                $("#node-config-input-clientid").change();
            }
            setTimeout(updateClientId,0);
            $("#node-config-input-cleansession").on("click",function() {
                updateClientId();
            });
        },
        oneditsave: function() {
            if (!$("#node-config-input-usetls").is(':checked')) {
                $("#node-config-input-tls").val("");
            }
        }
    });
</script>